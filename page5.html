<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans%3Awght@400;500;700;900&family=Work+Sans%3awght@400;500;700;900"
    />
    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
      .hidden { display: none; }
      .mbti-tab {
        text-align: center;
        flex: 1;
        cursor: pointer;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        flex-basis: 50%;
        max-width: 50%;
        transition: color 0.2s ease-out;
      }
      .mbti-tab p {
        transition: transform 0.2s ease-out;
      }
      .mbti-tab.w-full {
        flex-basis: 100%;
        max-width: 100%;
      }
      .mbti-tab-group .mbti-tab.active {
        border-bottom-color: #111418;
        color: #111418;
      }
      .mbti-tab-group .mbti-tab.active p {
        animation: float-animation 3s infinite ease-in-out;
      }
      .mbti-tab-group .mbti-tab:not(.active) {
        border-bottom-color: transparent;
        color: #637588;
      }
      .mbti-tab-group .mbti-tab:not(.active):hover p {
        animation: float-animation 3s infinite ease-in-out;
      }
      .mbti-tab-group .mbti-tab:not(.active):hover {
        color: #3e4c59;
      }
      @keyframes float-animation {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
      }
      #next-button, #learn-mbti-button {
        transition: transform 0.2s ease-out, background-color 0.2s ease-out;
      }
      #next-button:hover, #learn-mbti-button:hover {
        transform: translateY(-3px);
      }
      #next-button:hover {
        background-color: #1a73c8; 
      }
      #learn-mbti-button:hover {
        background-color: #e4e6e8;
      }
    </style>
  </head>
  <body>
    <div
      class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-auto"
      style='font-family: "Work Sans", "Noto Sans", sans-serif;'
    >
      <div class="layout-container flex h-full grow flex-col">
        <div id="header-placeholder"></div>
        <div class="flex flex-1 flex-col justify-center py-8 px-4 md:px-40 md:py-16">
          <div class="layout-content-container mx-auto flex w-full max-w-[700px] flex-col">
            <h2 class="px-4 pb-3 text-center text-[36px] font-bold leading-tight tracking-light text-[#111418]">MBTI</h2>
            <h3 class="px-4 pb-2 pt-6 text-xl font-bold leading-tight tracking-[-0.015em] text-[#111418]">
              <span id="target-name">상대방</span>의 MBTI
            </h3>
            <div class="mbti-tab-group pb-3" data-mbti-group="target_1">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="E">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">E</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="I">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">I</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="target_2">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="S">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">S</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="N">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">N</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="target_3">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="T">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">T</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="F">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">F</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="target_4">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="J">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">J</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="P">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">P</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="target_unknown">
              <div class="flex gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex w-full flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="unknown">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">아직 모름</p>
                </a>
              </div>
            </div>
            <h3 class="px-4 pb-2 pt-8 text-xl font-bold leading-tight tracking-[-0.015em] text-[#111418]">나의 MBTI</h3>
            <div class="mbti-tab-group pb-3" data-mbti-group="my_1">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="E">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">E</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="I">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">I</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="my_2">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="S">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">S</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="N">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">N</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="my_3">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="T">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">T</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="F">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">F</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="my_4">
              <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="J">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">J</p>
                </a>
                <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="P">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">P</p>
                </a>
              </div>
            </div>
            <div class="mbti-tab-group pb-3" data-mbti-group="my_unknown">
              <div class="flex gap-8 border-b border-[#dce0e5] px-4">
                <a class="mbti-tab flex w-full flex-col items-center justify-center border-b-[3px] pb-3 pt-4" href="#" data-mbti-value="unknown">
                  <p class="text-base font-bold leading-normal tracking-[0.015em]">아직 모름</p>
                </a>
              </div>
            </div>
            <div class="flex justify-between px-4 py-4">
              <button
                id="learn-mbti-button"
                class="flex h-12 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-[#f0f2f4] px-5 text-base font-bold leading-normal tracking-[0.015em] text-[#111418]"
              >
                <span class="truncate">내 MBTI 알아보기</span>
              </button>
              <button
                id="next-button"
                class="flex h-12 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-[#1466b8] px-5 text-base font-bold leading-normal tracking-[0.015em] text-white"
              >
                <span class="truncate">다음</span>
              </button>
            </div>
          </div>
        </div>
        <div id="footer-placeholder"></div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const nextButton = document.getElementById('next-button');
        const learnMbtiButton = document.getElementById('learn-mbti-button');
        const mbtiTabGroups = document.querySelectorAll('.mbti-tab-group');
        const targetNameElement = document.getElementById('target-name');

        const getParamsFromUrl = () => {
            const params = new URLSearchParams(window.location.search);
            return {
                name: params.get('name'),
                myMbti: params.get('mbti')
            };
        };

        const { name, myMbti } = getParamsFromUrl();

        if (name) {
            targetNameElement.textContent = name;
        }

        const activateMyMbtiTabs = (mbtiString) => {
            if (!mbtiString || mbtiString.length !== 4) return;
            const mbtiChars = mbtiString.split('');

            mbtiChars.forEach((char, index) => {
                const groupName = `my_${index + 1}`;
                const group = document.querySelector(`.mbti-tab-group[data-mbti-group="${groupName}"]`);
                if (group) {
                    const tab = group.querySelector(`.mbti-tab[data-mbti-value="${char}"]`);
                    if (tab) {
                        group.querySelectorAll('.mbti-tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                    }
                }
            });
        };

        if (myMbti) {
            activateMyMbtiTabs(myMbti);
        }

        mbtiTabGroups.forEach(group => {
            const tabs = group.querySelectorAll('.mbti-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const groupName = group.getAttribute('data-mbti-group');
                    
                    // *** 수정된 부분: '나의 MBTI'의 '아직 모름' 탭에 대한 특별 처리 ***
                    if (groupName === 'my_unknown') {
                        if (confirm('MBTI 테스트를 해보시겠습니까?')) {
                            const url = `mbti_test.html?name=${encodeURIComponent(name || '')}`;
                            window.location.href = url;
                        }
                        return; // 팝업 후 선택 로직을 실행하지 않고 종료
                    }

                    const isUnknownTab = tab.getAttribute('data-mbti-value') === 'unknown';
                    const groupPrefix = groupName.split('_')[0];

                    if (isUnknownTab) {
                        const mainGroups = document.querySelectorAll(`.mbti-tab-group[data-mbti-group^="${groupPrefix}_"]:not([data-mbti-group$="unknown"])`);
                        mainGroups.forEach(mainGroup => {
                            mainGroup.querySelectorAll('.mbti-tab').forEach(mainTab => {
                                mainTab.classList.remove('active');
                            });
                        });
                        group.querySelector('.mbti-tab[data-mbti-value="unknown"]').classList.add('active');
                    } else {
                        const parentDiv = tab.closest('.mbti-tab-group');
                        if (parentDiv) {
                            const siblingTabs = parentDiv.querySelectorAll('.mbti-tab');
                            siblingTabs.forEach(siblingTab => {
                                siblingTab.classList.remove('active');
                            });
                        }
                        const unknownGroup = document.querySelector(`.mbti-tab-group[data-mbti-group="${groupPrefix}_unknown"]`);
                        if (unknownGroup) {
                            const unknownTab = unknownGroup.querySelector('.mbti-tab[data-mbti-value="unknown"]');
                            if (unknownTab && unknownTab.classList.contains('active')) {
                                unknownTab.classList.remove('active');
                            }
                        }
                        tab.classList.add('active');
                    }
                });
            });
        });

        if (nextButton) {
            nextButton.addEventListener('click', () => {
                const mySelections = {};
                const targetSelections = {};

                document.querySelectorAll('.mbti-tab-group[data-mbti-group^="my_"]').forEach(group => {
                    const activeTab = group.querySelector('.mbti-tab.active');
                    if (activeTab) {
                        mySelections[group.getAttribute('data-mbti-group')] = activeTab.getAttribute('data-mbti-value');
                    }
                });
                document.querySelectorAll('.mbti-tab-group[data-mbti-group^="target_"]').forEach(group => {
                    const activeTab = group.querySelector('.mbti-tab.active');
                    if (activeTab) {
                        targetSelections[group.getAttribute('data-mbti-group')] = activeTab.getAttribute('data-mbti-value');
                    }
                });

                const checkMbtiSelection = (mbtiSelections, isMy) => {
                    const prefix = isMy ? 'my_' : 'target_';
                    const isUnknownSelected = mbtiSelections[`${prefix}unknown`] === 'unknown';
                    const allFourSelected = mbtiSelections[`${prefix}1`] && mbtiSelections[`${prefix}2`] && mbtiSelections[`${prefix}3`] && mbtiSelections[`${prefix}4`];
                    return isUnknownSelected || allFourSelected;
                };

                const isMyMbtiSelected = checkMbtiSelection(mySelections, true);
                const isTargetMbtiSelected = checkMbtiSelection(targetSelections, false);

                if (isMyMbtiSelected && isTargetMbtiSelected) {
                    const myMbtiResult = mySelections['my_unknown'] === 'unknown' ? 'unknown' : (mySelections['my_1'] + mySelections['my_2'] + mySelections['my_3'] + mySelections['my_4']);
                    const targetMbtiResult = targetSelections['target_unknown'] === 'unknown' ? 'unknown' : (targetSelections['target_1'] + targetSelections['target_2'] + targetSelections['target_3'] + targetSelections['target_4']);
                    
                    const url = `page6.html?name=${encodeURIComponent(name)}&my_mbti=${myMbtiResult}&target_mbti=${targetMbtiResult}`;
                    
                    window.location.href = url;
                } else {
                    alert('모든 MBTI 정보를 선택하거나 "아직 모름"을 체크해주세요.');
                }
            });
        }
        
        if (learnMbtiButton) {
            learnMbtiButton.addEventListener('click', () => {
                const url = `mbti_test.html?name=${encodeURIComponent(name || '')}`;
                window.location.href = url;
            });
        }
    });
   </script>
    <script src="loadComponents.js"></script>
  </body>
</html>