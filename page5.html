<!DOCTYPE html>
<html>
  <head>
    <!-- head에는 모든 페이지 공통 설정만 남깁니다 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
      tailwind.config = {
        theme: {
          fontFamily: {
            sans: ['Montserrat', 'Noto Sans KR', 'sans-serif'],
          }
        }
      }
    </script>
  </head>
  <body>
    <!-- 레이아웃을 불러올 자리 -->
    <div id="layout-placeholder"></div>

    <!-- 페이지 고유 콘텐츠 (스타일 포함) -->
    <div id="page-content" class="hidden">
      <!-- 이 페이지에서만 사용하는 스타일 -->
      <style>
        .mbti-tab { text-align: center; flex: 1; cursor: pointer; flex-basis: 50%; max-width: 50%; transition: color 0.2s ease-out; }
        .mbti-tab p { transition: transform 0.2s ease-out; }
        .mbti-tab.w-full { flex-basis: 100%; max-width: 100%; }
        .mbti-tab-group .mbti-tab.active { border-bottom-color: #111418; color: #111418; }
        .mbti-tab-group .mbti-tab.active p { animation: float-animation 3s infinite ease-in-out; }
        .mbti-tab-group .mbti-tab:not(.active) { border-bottom-color: transparent; color: #637588; }
        .mbti-tab-group .mbti-tab:not(.active):hover p { animation: float-animation 3s infinite ease-in-out; }
        .mbti-tab-group .mbti-tab:not(.active):hover { color: #3e4c59; }
        @keyframes float-animation { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }
        #next-button, #learn-mbti-button { transition: transform 0.2s ease-out, background-color 0.2s ease-out; }
        #next-button:hover, #learn-mbti-button:hover { transform: translateY(-3px); }
        #next-button:hover { background-color: #1a73c8; }
        #learn-mbti-button:hover { background-color: #e4e6e8; }
      </style>

      <!-- 페이지 실제 내용 -->
      <div class="flex flex-1 flex-col justify-center py-8 px-4 md:px-40 md:py-16">
        <div class="layout-content-container mx-auto flex w-full max-w-[700px] flex-col">
          <h2 class="px-4 pb-3 text-center text-[36px] font-bold leading-tight text-[#111418]">MBTI</h2>
          <h3 class="px-4 pb-2 pt-6 text-xl font-bold leading-tight text-[#111418]">
            <span id="target-name">상대방</span>의 MBTI
          </h3>
          <div class="mbti-tab-group pb-3" data-mbti-group="target_1">
            <div class="flex justify-center gap-8 border-b border-[#dce0e5] px-4">
              <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] py-3" href="#" data-mbti-value="E"><p class="text-base font-bold">E</p></a>
              <a class="mbti-tab flex flex-col items-center justify-center border-b-[3px] py-3" href="#" data-mbti-value="I"><p class="text-base font-bold">I</p></a>
            </div>
          </div>
          <!-- ... 나머지 MBTI 탭 그룹들 ... -->
          <div class="mbti-tab-group pb-3" data-mbti-group="target_unknown">
            <div class="flex gap-8 border-b border-[#dce0e5] px-4">
              <a class="mbti-tab flex w-full flex-col items-center justify-center border-b-[3px] py-3" href="#" data-mbti-value="unknown"><p class="text-base font-bold">아직 모름</p></a>
            </div>
          </div>
          <h3 class="px-4 pb-2 pt-8 text-xl font-bold leading-tight text-[#111418]">나의 MBTI</h3>
          <!-- ... 나의 MBTI 탭 그룹들 ... -->
          <div class="mbti-tab-group pb-3" data-mbti-group="my_unknown">
            <div class="flex gap-8 border-b border-[#dce0e5] px-4">
              <a class="mbti-tab flex w-full flex-col items-center justify-center border-b-[3px] py-3" href="#" data-mbti-value="unknown"><p class="text-base font-bold">아직 모름</p></a>
            </div>
          </div>
          <div class="flex justify-between px-4 py-4">
            <button id="learn-mbti-button" class="flex h-12 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-[#f0f2f4] px-5 text-base font-bold text-[#111418]"><span class="truncate">내 MBTI 알아보기</span></button>
            <button id="next-button" class="flex h-12 min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-[#1466b8] px-5 text-base font-bold text-white"><span class="truncate">다음</span></button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- *** 수정된 부분: 스크립트 실행 시점을 componentsLoaded로 변경 *** -->
    <script>
      const initializePage = () => {
        const nextButton = document.getElementById('next-button');
        const learnMbtiButton = document.getElementById('learn-mbti-button');
        const mbtiTabGroups = document.querySelectorAll('.mbti-tab-group');
        const targetNameElement = document.getElementById('target-name');

        const getParamsFromUrl = () => {
            const params = new URLSearchParams(window.location.search);
            return {
                name: params.get('name'),
                myMbti: params.get('mbti')
            };
        };

        const { name, myMbti } = getParamsFromUrl();

        if (name) {
            targetNameElement.textContent = name;
        }
        
        // --- 이하 모든 자바스크립트 로직은 기존과 동일 ---
        const saveTargetMbtiSelections = () => { /* ... */ };
        const restoreTargetMbtiSelections = () => { /* ... */ };
        const activateMyMbtiTabs = (mbtiString) => { /* ... */ };

        if (myMbti) activateMyMbtiTabs(myMbti);
        restoreTargetMbtiSelections();

        mbtiTabGroups.forEach(group => {
            // ... 탭 클릭 이벤트 로직 ...
        });

        if (nextButton) {
            nextButton.addEventListener('click', () => { /* ... */ });
        }
        
        if (learnMbtiButton) {
            learnMbtiButton.addEventListener('click', () => { /* ... */ });
        }
      };
      
      document.addEventListener('componentsLoaded', initializePage);
    </script>
    <script src="loadComponents.js"></script>
  </body>
</html>
